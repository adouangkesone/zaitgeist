<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zaitgeist — sign up for beta</title>

  <!-- fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Varela&display=swap" rel="stylesheet">
  <style>
    /* ===== quick knobs ===== */
    :root{
      --font: "Varela", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      --logo-size: 200px;           /* change this to resize logo */
      --field-bg: 0.35;            /* 0 = transparent, 1 = solid; try 0.25–0.45 */
      --field-blur: 6px;           /* backdrop blur under fields */
      --field-border: 0.18;        /* border visibility (0–.3) */
      --accent-1: #9a6dd7;         /* button gradient left */
      --accent-2: #cc77b9;         /* button gradient right */
      --ink: #2b2b2b;
    }

    /* ===== background ===== */
    :root {
      --bg1: #e9deff; --bg2: #dcffdc; --bg3: #ffdfd3; --bg4: #ffe1f0;
    }
    html,body{height:100%;margin:0;font-family:var(--font);color:var(--ink);}
    body{
      background:
        radial-gradient(clamp(400px, 65vw, 900px) clamp(350px, 45vw, 700px) at 30% 30%, var(--bg1), transparent 80%),
        radial-gradient(clamp(400px, 60vw, 850px) clamp(300px, 40vw, 600px) at 75% 65%, var(--bg2), transparent 80%),
        radial-gradient(clamp(450px, 70vw, 950px) clamp(350px, 45vw, 700px) at 45% 80%, var(--bg3), transparent 80%),
        radial-gradient(clamp(380px, 55vw, 800px) clamp(320px, 42vw, 650px) at 60% 25%, var(--bg4), transparent 80%),
        #fff;
      animation: drift 20s ease-in-out infinite alternate;
    }
    @keyframes drift{
      0%{background-position:30% 30%, 75% 65%, 45% 80%, 60% 25%}
      100%{background-position:35% 35%, 70% 60%, 40% 75%, 55% 30%}
    }

    /* ===== layout ===== */
    .wrap{max-width:900px;margin:0 auto;padding:28px 20px 96px;}
    /* center the brand horizontally */
    header{display:flex;align-items:center;gap:16px;justify-content:center}
    .brand-logo{height:var(--logo-size);width:auto}

    h1{
      font: weight 400; letter-spacing:.2px; 
      margin: clamp(24px, 4vw, 36px) 0 8px;
      font-size: clamp(27px, 4.7vw, 49px); line-height:1.04;
      text-align:center;
    }
    .sub{font-size:clamp(22px,3.8vw,39px);opacity:.8;margin:0 0 28px;text-align:center}

    form{max-width:760px;position:relative;margin:0 auto;padding:0 14px}
    label{font-size:16px;font-weight:600;margin:20px 0 8px;display:block;text-align:left}

    /* shared form field styles */
    .form-field,
    .control,
    .multi-toggle{
      width:100%;
      padding:12px 14px;
      font-size:18px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,var(--field-border));
      background:rgba(255,255,255,var(--field-bg));
      backdrop-filter:blur(var(--field-blur));
      min-height:48px;
      box-sizing:border-box;
      color:var(--ink);
      font-family:var(--font);
      box-shadow:0 10px 30px rgba(0,0,0,.08);
    }
    .form-field:focus,
    .control:focus,
    .multi-toggle:focus{
      outline:none;
      border-color:rgba(153,102,204,.45);
      box-shadow:0 0 0 4px rgba(153,102,204,.15), 0 10px 30px rgba(0,0,0,.08);
    }
    /* placeholder styling */
    .form-field::placeholder,
    .control::placeholder,
    .form-field .placeholder,
    .multi-toggle .placeholder{
      color:rgba(0,0,0,0.45);
      opacity:1;
    }

    /* simple dropdown multiselect styling */
    .multi-dropdown{position:relative;display:block}
    .multi-toggle{
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      text-align:left;
    }
    .multi-toggle::after{content:'▾';margin-left:auto;opacity:.65;font-size:14px}
    .multi-toggle .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));color:#fff;font-weight:700;margin-right:6px;font-size:0.95em}
    .multi-list{position:absolute;left:0;right:0;top:calc(100% + 8px);background:#fff;border-radius:12px;padding:8px 8px;box-shadow:0 10px 30px rgba(0,0,0,.08);max-height:220px;overflow:auto;border:1px solid rgba(0,0,0,.06);z-index:40}
    .multi-list li{list-style:none;margin:6px 2px}
    .multi-list label{display:flex;gap:8px;align-items:center;font-weight:500}
    /* keep visual parity with .control inputs */
    .multi-dropdown .control-like{border-radius:12px;padding:6px 10px}
    /* when closed, hide list */
    .multi-list.hidden{display:none}

    /* multi-select should be taller */
    select[multiple].control{
      min-height: 180px; /* adjust as you like */
    }

    .hint{font-size:14px;opacity:.8;margin-top:6px}

    button{
      margin:18px 0 0;padding:12px 20px;border-radius:14px;border:0;
      font-weight:800;cursor:pointer;color:#fff;
      background: linear-gradient(135deg,var(--accent-1),var(--accent-2));
      box-shadow: 0 8px 24px rgba(153,102,204,.28);
      display:inline-block;
      min-width:120px;
    }
    button:active{transform:translateY(1px)}

    .alert{display:none;margin-top:14px;font-size:16px;text-align:center}
    .ok{color:#165b31}
    .err{color:#7a1433}

    .note{font-size:14px;opacity:.75;margin-top:12px}

    /* form success state */
    .form-success{
      text-align:center;
      font-size:clamp(20px,3vw,24px);
      color:var(--ink);
      opacity:0;
      transform:translateY(10px);
      transition:opacity .6s ease,transform .6s ease;
      display:none;
      position:absolute;
      left:0;
      right:0;
      top:50%;
      transform:translateY(-50%);
      padding:0 14px;
      max-width:760px; /* match form width */
      margin:0 auto;
    }
    .form-success.show{
      opacity:1;
      transform:translateY(-50%);
      display:block;
    }
    #betaForm{
      transition:opacity .5s ease,transform .5s ease;
    }
    #betaForm.fade-out{
      opacity:0;
      transform:translateY(-10px);
      pointer-events:none;
    }

  /* page load staggered fade-in (accessible) */
  /* container remains visible; individual children animate top→bottom */
  .page-fade{opacity:1}
  .page-fade > *{
    opacity:0;
    transform:translateY(12px);
    transition:opacity .9s cubic-bezier(.2,.9,.2,1), transform .9s cubic-bezier(.2,.9,.2,1);
    will-change:opacity,transform;
  }
  .page-fade.show > *{opacity:1;transform:none}
  /* stagger delays for a calm top-to-bottom entrance */
  .page-fade > *:nth-child(1){transition-delay:0ms}
  .page-fade > *:nth-child(2){transition-delay:140ms}
  .page-fade > *:nth-child(3){transition-delay:280ms}
  .page-fade > *:nth-child(4){transition-delay:420ms}
  .page-fade > *:nth-child(n+5){transition-delay:560ms}

    @media (max-width:640px){
      .wrap{padding:20px 16px 72px}
      .brand-logo{height:calc(var(--logo-size) - 12px)}
    }
  </style>

  <meta property="og:title" content="Zaitgeist — sign up for beta" />
  <meta property="og:description" content="Want to explore deeper? Join the Zaitgeist beta." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#8b4ea9" />
</head>
<body>
  <div class="wrap page-fade">
    <header>
      <!-- keep your logo at /assets/logo.png -->
      <img src="assets/logo.png" alt="Zaitgeist" class="brand-logo">
    </header>

    <h1>want to explore deeper?</h1>
    <p class="sub">sign up for beta</p>

    <form id="betaForm" novalidate>
      <label for="email">email</label>
      <input 
        id="email" 
        name="email" 
        type="email" 
        required 
        pattern="[^@\s]+@[^@\s]+\.[^@\s]+" 
        title="Please enter a valid email address"
        placeholder="you@example.com" 
        class="control form-field" 
      />
     

      <label for="interest" style="margin-top:20px">where do you want zaitgeist to lead you?</label>

      <!-- DROPDOWN MULTISELECT -->
      <div id="interest" class="multi-dropdown" aria-haspopup="listbox" aria-expanded="false">
        <button type="button" class="multi-toggle" aria-haspopup="listbox" aria-expanded="false">be curious..</button>
        <ul class="multi-list hidden" role="listbox" aria-multiselectable="true">
          <li><label><input type="checkbox" value="In-person Events"> In-person Events</label></li>
          <li><label><input type="checkbox" value="Classes"> Classes</label></li>
          <li><label><input type="checkbox" value="Research Insights"> Research Insights</label></li>
          <li><label><input type="checkbox" value="New Artists"> New Artists</label></li>
          <li><label><input type="checkbox" value="Community Organizations"> Community Organizations</label></li>
          <li><label><input type="checkbox" value="Other"> Other</label></li>
        </ul>
      </div>

      <button type="submit">Submit</button>
      <div id="err" class="alert err">Something went wrong. Please try again.</div>
    </form>
    <div class="form-success">we'll let you know when you can dive into beta</div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwkfQqM8YB6mwv9Z0kgxUuVCVuiQnsu5QFtO0OoCHgBTjrX599sI4O8Zj8XET469RRm/exec";

  // Fade-in on page load (respects prefers-reduced-motion)
    (function(){
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const el = () => document.querySelector('.page-fade');
      if (prefersReduced){
        // no animation for users who prefer reduced motion
        document.addEventListener('DOMContentLoaded', ()=> el()?.classList.add('show'));
        return;
      }
      // Wait for DOM ready then use rAF to ensure transition runs
      document.addEventListener('DOMContentLoaded', ()=>{
        requestAnimationFrame(()=>{
          // small timeout can help on very fast loads
          setTimeout(()=> el()?.classList.add('show'), 8);
        });
      });
    })();

    // lightweight dropdown-multiselect behavior
    (function(){
      const root = document.getElementById('interest');
      if (!root) return;
      const btn = root.querySelector('.multi-toggle');
      const list = root.querySelector('.multi-list');
      const inputs = Array.from(root.querySelectorAll('input[type="checkbox"]'));

      function open(){
        list.classList.remove('hidden');
        root.setAttribute('aria-expanded','true');
        btn.setAttribute('aria-expanded','true');
      }
      function close(){
        list.classList.add('hidden');
        root.setAttribute('aria-expanded','false');
        btn.setAttribute('aria-expanded','false');
      }
      function toggle(){
        if (list.classList.contains('hidden')) open(); else close();
      }
      function updateLabel(){
        const checked = inputs.filter(i => i.checked).map(i => i.value);
        // clear current content
        btn.innerHTML = '';
        if (checked.length === 0){
          const span = document.createElement('span');
          span.className = 'placeholder';
          span.textContent = 'be curious..';
          btn.appendChild(span);
          btn.classList.add('empty');
        } else {
          btn.classList.remove('empty');
          // render pills for each selection
          checked.forEach(v => {
            const p = document.createElement('span');
            p.className = 'pill';
            p.textContent = v;
            btn.appendChild(p);
          });
        }
      }

      btn.addEventListener('click', (e)=>{ e.preventDefault(); toggle(); });

      // close when clicking outside
      document.addEventListener('click', (e)=>{ if (!root.contains(e.target)) close(); });

      // keyboard support: Space/Enter toggles, Escape closes
      btn.addEventListener('keydown', (e)=>{
        if (e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); toggle(); }
        if (e.key === 'Escape'){ close(); btn.focus(); }
      });

      inputs.forEach(i=> i.addEventListener('change', updateLabel));
      // initialize label from potential defaults
      updateLabel();
    })();

    const form = document.getElementById('betaForm');
    const ok = document.getElementById('ok');
    const err = document.getElementById('err');

    const successMsg = document.querySelector('.form-success');
    // Check for success parameter in URL
    if (window.location.search.includes('success=true')) {
      form.classList.add('fade-out');
      setTimeout(() => {
        successMsg.classList.add('show');
      }, 400);
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      err.style.display = 'none';
      
      // Rate limiting check
      const now = Date.now();
      const lastSubmit = localStorage.getItem('lastFormSubmit');
      const waitTime = 60000; // 1 minute cooldown
      
      if (lastSubmit && (now - parseInt(lastSubmit, 10)) < waitTime) {
        const remainingSeconds = Math.ceil((waitTime - (now - parseInt(lastSubmit, 10))) / 1000);
        err.textContent = `Please wait ${remainingSeconds} seconds before submitting again.`;
        err.style.display = 'block';
        return;
      }
      
      const email = document.getElementById('email').value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const sel = document.getElementById('interest');
      let interests = [];
      if (sel){
        if (sel.tagName === 'SELECT'){
          interests = Array.from(sel.selectedOptions).map(o => o.value);
        } else {
          interests = Array.from(sel.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.value);
        }
      }

      // Validate email format
      if (!email || !emailRegex.test(email)) {
        err.textContent = "Please enter a valid email address.";
        err.style.display = 'block';
        return;
      }

      // Validate interests
      if (interests.length === 0) {
        err.textContent = "Please select at least one interest.";
        err.style.display = 'block';
        return;
      }

      // Create a hidden form in an iframe to avoid CORS
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      document.body.appendChild(iframe);

      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      const iframeForm = iframeDoc.createElement('form');
      iframeForm.method = 'POST';
      iframeForm.action = SCRIPT_URL;

      // Add the form fields
      const emailInput = iframeDoc.createElement('input');
      emailInput.type = 'hidden';
      emailInput.name = 'Email';
      emailInput.value = email;
      iframeForm.appendChild(emailInput);

      const interestsInput = iframeDoc.createElement('input');
      interestsInput.type = 'hidden';
      interestsInput.name = 'where do you want zaitgeist to lead you?';
      interestsInput.value = interests.join(", ");
      iframeForm.appendChild(interestsInput);

      iframeDoc.body.appendChild(iframeForm);
      
      // Show success state after a short delay
      setTimeout(() => {
        form.classList.add('fade-out');
        setTimeout(() => {
          successMsg.classList.add('show');
        }, 400);
      }, 1000);

      // Submit the form and clean up
      iframeForm.submit();
      // Store submission timestamp for rate limiting
      localStorage.setItem('lastFormSubmit', Date.now().toString());
      setTimeout(() => {
        document.body.removeChild(iframe);
      }, 5000);
    });
  </script>
</body>
</html>
